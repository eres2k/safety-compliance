<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WHS Safety Compliance Navigator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .framework-at { --accent: #ED2939; --accent-light: #FEE2E2; }
        .framework-de { --accent: #FFCC00; --accent-light: #FEF3C7; }
        .framework-nl { --accent: #FF6600; --accent-light: #FFEDD5; }
        .accent-border { border-color: var(--accent); }
        .accent-bg { background-color: var(--accent); }
        .accent-bg-light { background-color: var(--accent-light); }
        .accent-text { color: var(--accent); }
        .tree-item:hover { background-color: #f3f4f6; }
        .highlight { background-color: #fef08a; padding: 0 2px; border-radius: 2px; }
        .module-card { transition: all 0.2s ease; }
        .module-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); }
        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo, createContext, useContext } = React;

        // ==================== LOCALIZATION ====================
        const translations = {
            en: {
                appTitle: "WHS Safety Compliance Navigator",
                appSubtitle: "AI-Powered Workplace Safety Assistant",
                selectFramework: "Select Legal Framework",
                austria: "Austria (ASchG)",
                germany: "Germany (DGUV)",
                netherlands: "Netherlands (Arbowet)",
                modules: {
                    lawBrowser: "Law Browser & Search",
                    lawBrowserDesc: "Navigate and search safety legislation",
                    complianceChecker: "Compliance Checker",
                    complianceCheckerDesc: "Check requirements for your company",
                    documentGenerator: "Document Generator",
                    documentGeneratorDesc: "Create safety documents from templates",
                    quickReference: "Quick Reference Tools",
                    quickReferenceDesc: "Calculators, lookups, and glossary",
                    regulationLookup: "Regulation Lookup",
                    regulationLookupDesc: "Query specific requirements"
                },
                common: {
                    search: "Search",
                    searchPlaceholder: "Search laws and regulations...",
                    back: "Back to Modules",
                    generate: "Generate",
                    calculate: "Calculate",
                    lookup: "Look Up",
                    copy: "Copy",
                    download: "Download",
                    bookmark: "Bookmark",
                    bookmarked: "Bookmarked",
                    explain: "Explain Simply",
                    loading: "Loading",
                    noResults: "No results found",
                    selectOption: "Select an option",
                    companySize: "Company Size",
                    industry: "Industry Type",
                    topic: "Topic",
                    employees: "employees",
                    apiKeyPlaceholder: "Enter your Gemini API key",
                    apiKeyInfo: "Your API key is stored locally and never sent to our servers",
                    saveApiKey: "Save API Key",
                    clearApiKey: "Clear API Key"
                },
                industries: {
                    logistics: "Logistics & Warehousing",
                    manufacturing: "Manufacturing",
                    construction: "Construction",
                    office: "Office Work",
                    healthcare: "Healthcare",
                    retail: "Retail",
                    hospitality: "Hospitality",
                    education: "Education"
                },
                topics: {
                    firstAid: "First Aid",
                    fireSafety: "Fire Safety",
                    ppe: "Personal Protective Equipment",
                    hazardous: "Hazardous Substances",
                    ergonomics: "Ergonomics",
                    machinery: "Machinery Safety",
                    electrical: "Electrical Safety",
                    workingHours: "Working Hours",
                    training: "Safety Training"
                },
                documents: {
                    riskAssessment: "Risk Assessment Template",
                    asaMeeting: "ASA Meeting Agenda",
                    committeeMinutes: "Safety Committee Minutes",
                    inspectionChecklist: "Workplace Inspection Checklist",
                    incidentReport: "Incident Report Form",
                    trainingDoc: "Training Documentation"
                },
                tools: {
                    deadlineCalculator: "Deadline Calculator",
                    penaltyLookup: "Penalty Lookup Table",
                    personnelCalculator: "Required Personnel Calculator",
                    glossary: "Abbreviation Glossary"
                }
            },
            de: {
                appTitle: "WHS Arbeitsschutz-Navigator",
                appSubtitle: "KI-gest√ºtzte Arbeitsschutz-Assistenz",
                selectFramework: "Rechtsrahmen w√§hlen",
                austria: "√ñsterreich (ASchG)",
                germany: "Deutschland (DGUV)",
                netherlands: "Niederlande (Arbowet)",
                modules: {
                    lawBrowser: "Gesetzes-Browser & Suche",
                    lawBrowserDesc: "Arbeitsschutzgesetze durchsuchen",
                    complianceChecker: "Compliance-Pr√ºfer",
                    complianceCheckerDesc: "Anforderungen f√ºr Ihr Unternehmen pr√ºfen",
                    documentGenerator: "Dokumenten-Generator",
                    documentGeneratorDesc: "Sicherheitsdokumente aus Vorlagen erstellen",
                    quickReference: "Schnellreferenz-Tools",
                    quickReferenceDesc: "Rechner, Nachschlagewerke und Glossar",
                    regulationLookup: "Vorschriften-Abfrage",
                    regulationLookupDesc: "Spezifische Anforderungen abfragen"
                },
                common: {
                    search: "Suchen",
                    searchPlaceholder: "Gesetze und Vorschriften durchsuchen...",
                    back: "Zur√ºck zu Modulen",
                    generate: "Generieren",
                    calculate: "Berechnen",
                    lookup: "Nachschlagen",
                    copy: "Kopieren",
                    download: "Herunterladen",
                    bookmark: "Lesezeichen",
                    bookmarked: "Markiert",
                    explain: "Einfach erkl√§ren",
                    loading: "L√§dt",
                    noResults: "Keine Ergebnisse gefunden",
                    selectOption: "Option w√§hlen",
                    companySize: "Unternehmensgr√∂√üe",
                    industry: "Branche",
                    topic: "Thema",
                    employees: "Mitarbeiter",
                    apiKeyPlaceholder: "Gemini API-Schl√ºssel eingeben",
                    apiKeyInfo: "Ihr API-Schl√ºssel wird lokal gespeichert",
                    saveApiKey: "API-Schl√ºssel speichern",
                    clearApiKey: "API-Schl√ºssel l√∂schen"
                },
                industries: {
                    logistics: "Logistik & Lagerhaltung",
                    manufacturing: "Produktion",
                    construction: "Bauwesen",
                    office: "B√ºroarbeit",
                    healthcare: "Gesundheitswesen",
                    retail: "Einzelhandel",
                    hospitality: "Gastgewerbe",
                    education: "Bildungswesen"
                },
                topics: {
                    firstAid: "Erste Hilfe",
                    fireSafety: "Brandschutz",
                    ppe: "Pers√∂nliche Schutzausr√ºstung",
                    hazardous: "Gefahrstoffe",
                    ergonomics: "Ergonomie",
                    machinery: "Maschinensicherheit",
                    electrical: "Elektrische Sicherheit",
                    workingHours: "Arbeitszeiten",
                    training: "Sicherheitsschulung"
                },
                documents: {
                    riskAssessment: "Gef√§hrdungsbeurteilung",
                    asaMeeting: "ASA-Sitzung Tagesordnung",
                    committeeMinutes: "Ausschuss-Protokoll",
                    inspectionChecklist: "Begehungs-Checkliste",
                    incidentReport: "Unfallbericht",
                    trainingDoc: "Schulungsnachweis"
                },
                tools: {
                    deadlineCalculator: "Fristen-Rechner",
                    penaltyLookup: "Bu√ügeld-Tabelle",
                    personnelCalculator: "Personal-Rechner",
                    glossary: "Abk√ºrzungsverzeichnis"
                }
            },
            nl: {
                appTitle: "WHS Veiligheids-Navigator",
                appSubtitle: "AI-gestuurde Arbo-assistent",
                selectFramework: "Selecteer Rechtskader",
                austria: "Oostenrijk (ASchG)",
                germany: "Duitsland (DGUV)",
                netherlands: "Nederland (Arbowet)",
                modules: {
                    lawBrowser: "Wetgeving Browser & Zoeken",
                    lawBrowserDesc: "Navigeer en zoek arbowetgeving",
                    complianceChecker: "Compliance Checker",
                    complianceCheckerDesc: "Controleer vereisten voor uw bedrijf",
                    documentGenerator: "Document Generator",
                    documentGeneratorDesc: "Maak veiligheidsdocumenten van sjablonen",
                    quickReference: "Snelle Referentie Tools",
                    quickReferenceDesc: "Calculators, opzoektabellen en glossarium",
                    regulationLookup: "Voorschriften Opzoeken",
                    regulationLookupDesc: "Zoek specifieke vereisten op"
                },
                common: {
                    search: "Zoeken",
                    searchPlaceholder: "Zoek wetten en voorschriften...",
                    back: "Terug naar Modules",
                    generate: "Genereren",
                    calculate: "Berekenen",
                    lookup: "Opzoeken",
                    copy: "Kopi√´ren",
                    download: "Downloaden",
                    bookmark: "Bladwijzer",
                    bookmarked: "Gemarkeerd",
                    explain: "Eenvoudig uitleggen",
                    loading: "Laden",
                    noResults: "Geen resultaten gevonden",
                    selectOption: "Selecteer een optie",
                    companySize: "Bedrijfsgrootte",
                    industry: "Industrie Type",
                    topic: "Onderwerp",
                    employees: "werknemers",
                    apiKeyPlaceholder: "Voer uw Gemini API-sleutel in",
                    apiKeyInfo: "Uw API-sleutel wordt lokaal opgeslagen",
                    saveApiKey: "API-sleutel opslaan",
                    clearApiKey: "API-sleutel wissen"
                },
                industries: {
                    logistics: "Logistiek & Magazijn",
                    manufacturing: "Productie",
                    construction: "Bouw",
                    office: "Kantoorwerk",
                    healthcare: "Gezondheidszorg",
                    retail: "Detailhandel",
                    hospitality: "Horeca",
                    education: "Onderwijs"
                },
                topics: {
                    firstAid: "Eerste Hulp",
                    fireSafety: "Brandveiligheid",
                    ppe: "Persoonlijke Beschermingsmiddelen",
                    hazardous: "Gevaarlijke Stoffen",
                    ergonomics: "Ergonomie",
                    machinery: "Machineveiligheid",
                    electrical: "Elektrische Veiligheid",
                    workingHours: "Werktijden",
                    training: "Veiligheidstraining"
                },
                documents: {
                    riskAssessment: "Risico-inventarisatie",
                    asaMeeting: "Arbo-vergadering Agenda",
                    committeeMinutes: "Commissie Notulen",
                    inspectionChecklist: "Inspectie Checklist",
                    incidentReport: "Incidentrapport",
                    trainingDoc: "Trainingsdocumentatie"
                },
                tools: {
                    deadlineCalculator: "Deadline Calculator",
                    penaltyLookup: "Boetes Opzoektabel",
                    personnelCalculator: "Personeel Calculator",
                    glossary: "Afkortingen Glossarium"
                }
            }
        };

        // ==================== LAW DATA ====================
        const lawData = {
            AT: {
                name: "ASchG - ArbeitnehmerInnenschutzgesetz",
                sections: [
                    {
                        id: "part1",
                        title: "1. Teil: Allgemeine Bestimmungen",
                        sections: [
                            { id: "1", title: "¬ß 1 Geltungsbereich", content: "Dieses Bundesgesetz gilt f√ºr die Besch√§ftigung von Arbeitnehmerinnen und Arbeitnehmern. Es regelt die Pflichten der Arbeitgeber sowie die Rechte und Pflichten der Arbeitnehmer auf dem Gebiet des Arbeitnehmerschutzes." },
                            { id: "2", title: "¬ß 2 Begriffsbestimmungen", content: "Arbeitsst√§tten sind Arbeitsst√§tten in Geb√§uden, Arbeitsst√§tten im Freien, Baustellen und ausw√§rtige Arbeitsstellen." },
                            { id: "3", title: "¬ß 3 Allgemeine Pflichten der Arbeitgeber", content: "Arbeitgeber sind verpflichtet, f√ºr Sicherheit und Gesundheitsschutz der Arbeitnehmer in Bezug auf alle Aspekte, die die Arbeit betreffen, zu sorgen." }
                        ]
                    },
                    {
                        id: "part4",
                        title: "4. Teil: Arbeitsst√§tten",
                        sections: [
                            { id: "19", title: "¬ß 19 Allgemeine Anforderungen", content: "Arbeitsst√§tten m√ºssen so geplant, errichtet und betrieben werden, dass die Sicherheit und der Gesundheitsschutz der Arbeitnehmer gew√§hrleistet sind." },
                            { id: "20", title: "¬ß 20 Nichtraucherschutz", content: "Arbeitgeber haben daf√ºr zu sorgen, dass Nichtraucher vor den Einwirkungen von Tabakrauch am Arbeitsplatz gesch√ºtzt sind." }
                        ]
                    },
                    {
                        id: "part5",
                        title: "5. Teil: Arbeitsmittel und Arbeitsstoffe",
                        sections: [
                            { id: "33", title: "¬ß 33 Allgemeine Bestimmungen √ºber Arbeitsmittel", content: "Arbeitgeber haben daf√ºr zu sorgen, dass die den Arbeitnehmern zur Verf√ºgung gestellten Arbeitsmittel f√ºr die jeweilige Arbeit geeignet sind." },
                            { id: "40", title: "¬ß 40 Arbeitsstoffe", content: "Arbeitgeber haben zu ermitteln, welche Arbeitsstoffe an Arbeitspl√§tzen verwendet werden, und zu beurteilen, welche Gefahren von ihnen ausgehen." }
                        ]
                    },
                    {
                        id: "part6",
                        title: "6. Teil: Gesundheits√ºberwachung",
                        sections: [
                            { id: "49", title: "¬ß 49 Eignungs- und Folgeuntersuchungen", content: "Arbeitnehmer, die bestimmte T√§tigkeiten aus√ºben, sind vor Aufnahme der T√§tigkeit und danach in regelm√§√üigen Zeitabst√§nden √§rztlich zu untersuchen." }
                        ]
                    },
                    {
                        id: "part7",
                        title: "7. Teil: Pr√§ventivdienste",
                        sections: [
                            { id: "73", title: "¬ß 73 Sicherheitsfachkraft", content: "Arbeitgeber haben Sicherheitsfachkr√§fte zu besch√§ftigen. Die Sicherheitsfachkraft hat die Aufgabe, die Arbeitgeber, die Arbeitnehmer, die Sicherheitsvertrauenspersonen und die Belegschaftsorgane zu beraten und zu unterst√ºtzen." },
                            { id: "76", title: "¬ß 76 Arbeitsmediziner", content: "Arbeitgeber haben Arbeitsmediziner zu besch√§ftigen. Die Arbeitsmediziner haben die Aufgabe, die Arbeitgeber, die Arbeitnehmer, die Sicherheitsvertrauenspersonen und die Belegschaftsorgane in arbeitsmedizinischen Fragen zu beraten." },
                            { id: "78", title: "¬ß 78 Pr√§ventionszeit", content: "Die Pr√§ventionszeit ist jene Zeit, die den Sicherheitsfachkr√§ften und Arbeitsmedizinern f√ºr ihre Aufgaben mindestens zur Verf√ºgung stehen muss." }
                        ]
                    },
                    {
                        id: "part8",
                        title: "8. Teil: Sicherheitsvertrauenspersonen, Sicherheitsfachkr√§fte",
                        sections: [
                            { id: "10", title: "¬ß 10 Sicherheitsvertrauenspersonen", content: "In Arbeitsst√§tten mit regelm√§√üig mehr als 10 Arbeitnehmern sind Sicherheitsvertrauenspersonen zu bestellen. Die Anzahl richtet sich nach der Zahl der Besch√§ftigten." },
                            { id: "25", title: "¬ß 25 Erste Hilfe", content: "Arbeitgeber haben daf√ºr zu sorgen, dass in jeder Arbeitsst√§tte die f√ºr die Erste-Hilfe-Leistung erforderlichen Mittel bereitgehalten werden und eine ausreichende Anzahl von Arbeitnehmern ausgebildet ist." }
                        ]
                    }
                ]
            },
            DE: {
                name: "DGUV & Arbeitsschutzgesetz (ArbSchG)",
                sections: [
                    {
                        id: "part1",
                        title: "Erster Abschnitt: Allgemeine Vorschriften",
                        sections: [
                            { id: "1", title: "¬ß 1 Zielsetzung und Anwendungsbereich", content: "Dieses Gesetz dient dazu, Sicherheit und Gesundheitsschutz der Besch√§ftigten bei der Arbeit durch Ma√ünahmen des Arbeitsschutzes zu sichern und zu verbessern." },
                            { id: "2", title: "¬ß 2 Begriffsbestimmungen", content: "Ma√ünahmen des Arbeitsschutzes sind Ma√ünahmen zur Verh√ºtung von Unf√§llen bei der Arbeit und arbeitsbedingten Gesundheitsgefahren einschlie√ülich Ma√ünahmen der menschengerechten Gestaltung der Arbeit." }
                        ]
                    },
                    {
                        id: "part2",
                        title: "Zweiter Abschnitt: Pflichten des Arbeitgebers",
                        sections: [
                            { id: "3", title: "¬ß 3 Grundpflichten des Arbeitgebers", content: "Der Arbeitgeber ist verpflichtet, die erforderlichen Ma√ünahmen des Arbeitsschutzes unter Ber√ºcksichtigung der Umst√§nde zu treffen, die Sicherheit und Gesundheit der Besch√§ftigten bei der Arbeit beeinflussen." },
                            { id: "4", title: "¬ß 4 Allgemeine Grunds√§tze", content: "Der Arbeitgeber hat bei Ma√ünahmen des Arbeitsschutzes von folgenden allgemeinen Grunds√§tzen auszugehen: Die Arbeit ist so zu gestalten, dass eine Gef√§hrdung f√ºr das Leben sowie die physische und die psychische Gesundheit m√∂glichst vermieden wird." },
                            { id: "5", title: "¬ß 5 Beurteilung der Arbeitsbedingungen", content: "Der Arbeitgeber hat durch eine Beurteilung der f√ºr die Besch√§ftigten mit ihrer Arbeit verbundenen Gef√§hrdung zu ermitteln, welche Ma√ünahmen des Arbeitsschutzes erforderlich sind (Gef√§hrdungsbeurteilung)." },
                            { id: "6", title: "¬ß 6 Dokumentation", content: "Der Arbeitgeber muss √ºber die erforderlichen Unterlagen verf√ºgen, aus denen das Ergebnis der Gef√§hrdungsbeurteilung, die festgelegten Ma√ünahmen und das Ergebnis ihrer √úberpr√ºfung ersichtlich sind." }
                        ]
                    },
                    {
                        id: "part3",
                        title: "Dritter Abschnitt: Pflichten und Rechte der Besch√§ftigten",
                        sections: [
                            { id: "15", title: "¬ß 15 Pflichten der Besch√§ftigten", content: "Die Besch√§ftigten sind verpflichtet, nach ihren M√∂glichkeiten sowie gem√§√ü der Unterweisung und Weisung des Arbeitgebers f√ºr ihre Sicherheit und Gesundheit bei der Arbeit Sorge zu tragen." },
                            { id: "16", title: "¬ß 16 Besondere Unterst√ºtzungspflichten", content: "Die Besch√§ftigten haben dem Arbeitgeber jede von ihnen festgestellte unmittelbare erhebliche Gefahr f√ºr die Sicherheit und Gesundheit unverz√ºglich zu melden." }
                        ]
                    },
                    {
                        id: "dguv1",
                        title: "DGUV Vorschrift 1: Grunds√§tze der Pr√§vention",
                        sections: [
                            { id: "d2", title: "¬ß 2 Grundpflichten des Unternehmers", content: "Der Unternehmer hat die erforderlichen Ma√ünahmen zur Verh√ºtung von Arbeitsunf√§llen, Berufskrankheiten und arbeitsbedingten Gesundheitsgefahren sowie f√ºr eine wirksame Erste Hilfe zu treffen." },
                            { id: "d4", title: "¬ß 4 Unterweisung der Versicherten", content: "Der Unternehmer hat die Versicherten √ºber Sicherheit und Gesundheitsschutz bei der Arbeit zu unterweisen. Die Unterweisung muss vor Aufnahme der T√§tigkeit erfolgen und danach mindestens j√§hrlich wiederholt werden." },
                            { id: "d22", title: "¬ß 22 Notfallma√ünahmen", content: "Der Unternehmer hat entsprechend der Art der Arbeitsst√§tte und der T√§tigkeiten sowie der Zahl der Besch√§ftigten die Ma√ünahmen zu treffen, die zur Ersten Hilfe, Brandbek√§mpfung und Evakuierung der Besch√§ftigten erforderlich sind." }
                        ]
                    },
                    {
                        id: "asa",
                        title: "ASiG - Arbeitssicherheitsgesetz",
                        sections: [
                            { id: "a1", title: "¬ß 1 Fachkr√§fte f√ºr Arbeitssicherheit", content: "Der Arbeitgeber hat Fachkr√§fte f√ºr Arbeitssicherheit (Sicherheitsingenieure, Sicherheitstechniker, Sicherheitsmeister) zu bestellen." },
                            { id: "a2", title: "¬ß 2 Betriebs√§rzte", content: "Der Arbeitgeber hat Betriebs√§rzte zu bestellen. Sie haben die Aufgabe, ihn beim Arbeitsschutz und bei der Unfallverh√ºtung zu unterst√ºtzen." },
                            { id: "a11", title: "¬ß 11 Arbeitsschutzausschuss", content: "Soweit in einer sonstigen Rechtsvorschrift nichts anderes bestimmt ist, hat der Arbeitgeber in Betrieben mit mehr als zwanzig Besch√§ftigten einen Arbeitsschutzausschuss (ASA) zu bilden." }
                        ]
                    }
                ]
            },
            NL: {
                name: "Arbowet - Arbeidsomstandighedenwet",
                sections: [
                    {
                        id: "ch1",
                        title: "Hoofdstuk 1: Begrippen en toepassingsgebied",
                        sections: [
                            { id: "1", title: "Artikel 1 Begripsbepalingen", content: "In deze wet en de daarop berustende bepalingen wordt verstaan onder: arbeid, arbeidsomstandigheden, werkgever, werknemer en arbeidsplaats." },
                            { id: "2", title: "Artikel 2 Toepassingsgebied", content: "Deze wet is van toepassing op arbeid verricht in Nederland en de Nederlandse exclusieve economische zone." }
                        ]
                    },
                    {
                        id: "ch2",
                        title: "Hoofdstuk 2: Arbeidsomstandighedenbeleid",
                        sections: [
                            { id: "3", title: "Artikel 3 Algemeen arbeidsomstandighedenbeleid", content: "De werkgever zorgt voor de veiligheid en de gezondheid van de werknemers inzake alle met de arbeid verbonden aspecten en voert daartoe een beleid dat is gericht op zo goed mogelijke arbeidsomstandigheden." },
                            { id: "5", title: "Artikel 5 Inventarisatie en evaluatie van risico's", content: "Bij het voeren van het arbeidsomstandighedenbeleid legt de werkgever in een inventarisatie en evaluatie schriftelijk vast welke risico's de arbeid voor de werknemers met zich brengt (RI&E)." },
                            { id: "8", title: "Artikel 8 Voorlichting en onderricht", content: "De werkgever zorgt ervoor dat de werknemers doeltreffend worden ingelicht over de te verrichten werkzaamheden en de daaraan verbonden risico's, alsmede over de maatregelen die erop gericht zijn deze risico's te voorkomen of te beperken." }
                        ]
                    },
                    {
                        id: "ch3",
                        title: "Hoofdstuk 3: Bijzondere verplichtingen",
                        sections: [
                            { id: "13", title: "Artikel 13 Bijstand deskundige werknemers", content: "De werkgever laat zich bijstaan door een of meer deskundige werknemers ten aanzien van het voorkomen en de bestrijding van arbeidsrisico's." },
                            { id: "14", title: "Artikel 14 Maatwerkregeling", content: "De werkgever kan voor de organisatie van de deskundige bijstand kiezen voor een maatwerkregeling als bedoeld in dit artikel of voor de vangnetregeling." },
                            { id: "15", title: "Artikel 15 Voorzieningen en persoonlijke beschermingsmiddelen", content: "De werkgever zorgt voor de nodige voorzieningen voor eerste hulp bij ongevallen, brandbestrijding en evacuatie van werknemers." }
                        ]
                    },
                    {
                        id: "ch4",
                        title: "Hoofdstuk 4: Werknemersverplichtingen",
                        sections: [
                            { id: "11", title: "Artikel 11 Verplichtingen werknemers", content: "De werknemer is verplicht om in zijn doen en laten op de arbeidsplaats, overeenkomstig zijn opleiding en de door de werkgever gegeven instructies, naar vermogen zorg te dragen voor zijn eigen veiligheid en gezondheid en die van de andere betrokken personen." }
                        ]
                    },
                    {
                        id: "ch5",
                        title: "Hoofdstuk 5: Toezicht en handhaving",
                        sections: [
                            { id: "24", title: "Artikel 24 Nederlandse Arbeidsinspectie", content: "Met het toezicht op de naleving van het bepaalde bij of krachtens deze wet zijn belast de bij besluit van Onze Minister aangewezen ambtenaren (Inspectie SZW)." },
                            { id: "27", title: "Artikel 27 Eis tot naleving", content: "Een daartoe aangewezen toezichthouder kan aan een werkgever of een werknemer een eis stellen betreffende de wijze waarop een of meer bepalingen van deze wet moeten worden nageleefd." },
                            { id: "33", title: "Artikel 33 Beboetbare feiten", content: "Als overtreding wordt aangemerkt het niet naleven van de artikelen en de op grond daarvan gestelde voorschriften. De boete bedraagt ten hoogste de geldboete van de vijfde categorie." }
                        ]
                    }
                ]
            }
        };

        // ==================== CONTEXT ====================
        const AppContext = createContext();

        const useApp = () => useContext(AppContext);

        // ==================== AI SERVICE ====================
        const generateAIResponse = async (prompt, apiKey, framework, language) => {
            if (!apiKey) {
                throw new Error('API key not configured');
            }

            const frameworkContext = {
                AT: 'Austrian ASchG (ArbeitnehmerInnenschutzgesetz)',
                DE: 'German DGUV and ArbSchG (Arbeitsschutzgesetz)',
                NL: 'Dutch Arbowet (Arbeidsomstandighedenwet)'
            };

            const languageContext = {
                en: 'Respond in English.',
                de: 'Antworten Sie auf Deutsch.',
                nl: 'Antwoord in het Nederlands.'
            };

            const systemPrompt = `You are a Workplace Health and Safety legal expert specializing in ${frameworkContext[framework]}.

RULES:
1. ALWAYS cite specific paragraphs (e.g., "¬ß 25 ASchG" or "¬ß 5 ArbSchG" or "Artikel 5 Arbowet")
2. Provide practical, actionable guidance
3. Be precise with legal requirements
4. When explaining complex terms, use plain language
5. If unsure, recommend consulting authorities or legal counsel
6. Structure responses with clear sections
7. Include relevant deadlines and penalties where applicable
8. ${languageContext[language]}

Current Legal Framework: ${framework}
Framework Name: ${frameworkContext[framework]}`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        generationConfig: {
                            temperature: 0.3,
                            maxOutputTokens: 2048
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('AI request failed');
                }

                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || 'No response generated';
            } catch (error) {
                throw error;
            }
        };

        // ==================== COMPONENTS ====================

        // Header Component
        const Header = () => {
            const { framework, setFramework, language, setLanguage, t } = useApp();

            const frameworkColors = {
                AT: 'framework-at',
                DE: 'framework-de',
                NL: 'framework-nl'
            };

            return (
                <header className={`${frameworkColors[framework]} bg-white shadow-sm border-b-4 accent-border`}>
                    <div className="max-w-7xl mx-auto px-4 py-4">
                        <div className="flex flex-wrap items-center justify-between gap-4">
                            <div>
                                <h1 className="text-2xl font-bold text-gray-900">{t.appTitle}</h1>
                                <p className="text-sm text-gray-600">{t.appSubtitle}</p>
                            </div>

                            <div className="flex items-center gap-4">
                                {/* Language Selector */}
                                <select
                                    value={language}
                                    onChange={(e) => setLanguage(e.target.value)}
                                    className="px-3 py-2 border rounded-lg bg-white text-sm"
                                >
                                    <option value="en">üá¨üáß English</option>
                                    <option value="de">üá©üá™ Deutsch</option>
                                    <option value="nl">üá≥üá± Nederlands</option>
                                </select>

                                {/* Framework Selector */}
                                <div className="flex rounded-lg overflow-hidden border">
                                    <button
                                        onClick={() => setFramework('AT')}
                                        className={`px-4 py-2 text-sm font-medium transition ${framework === 'AT' ? 'bg-red-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-50'}`}
                                    >
                                        üá¶üáπ ASchG
                                    </button>
                                    <button
                                        onClick={() => setFramework('DE')}
                                        className={`px-4 py-2 text-sm font-medium transition ${framework === 'DE' ? 'bg-yellow-500 text-black' : 'bg-white text-gray-700 hover:bg-gray-50'}`}
                                    >
                                        üá©üá™ DGUV
                                    </button>
                                    <button
                                        onClick={() => setFramework('NL')}
                                        className={`px-4 py-2 text-sm font-medium transition ${framework === 'NL' ? 'bg-orange-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-50'}`}
                                    >
                                        üá≥üá± Arbowet
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        // API Key Setup Component
        const ApiKeySetup = () => {
            const { apiKey, setApiKey, t } = useApp();
            const [inputKey, setInputKey] = useState('');
            const [showKey, setShowKey] = useState(false);

            const handleSave = () => {
                if (inputKey.trim()) {
                    setApiKey(inputKey.trim());
                    localStorage.setItem('gemini_api_key', inputKey.trim());
                    setInputKey('');
                }
            };

            const handleClear = () => {
                setApiKey('');
                localStorage.removeItem('gemini_api_key');
            };

            if (apiKey) {
                return (
                    <div className="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <span className="text-green-600">‚úì</span>
                                <span className="text-green-700 font-medium">API Key configured</span>
                            </div>
                            <button
                                onClick={handleClear}
                                className="text-sm text-red-600 hover:text-red-800"
                            >
                                {t.common.clearApiKey}
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6">
                    <h3 className="font-medium text-amber-800 mb-2">Gemini API Key Required</h3>
                    <p className="text-sm text-amber-700 mb-3">{t.common.apiKeyInfo}</p>
                    <div className="flex gap-2">
                        <input
                            type={showKey ? 'text' : 'password'}
                            value={inputKey}
                            onChange={(e) => setInputKey(e.target.value)}
                            placeholder={t.common.apiKeyPlaceholder}
                            className="flex-1 px-3 py-2 border rounded-lg text-sm"
                        />
                        <button
                            onClick={() => setShowKey(!showKey)}
                            className="px-3 py-2 border rounded-lg text-sm hover:bg-gray-50"
                        >
                            {showKey ? 'üôà' : 'üëÅÔ∏è'}
                        </button>
                        <button
                            onClick={handleSave}
                            className="px-4 py-2 bg-amber-600 text-white rounded-lg text-sm hover:bg-amber-700"
                        >
                            {t.common.saveApiKey}
                        </button>
                    </div>
                </div>
            );
        };

        // Module Card Component
        const ModuleCard = ({ icon, title, description, onClick }) => {
            const { framework } = useApp();
            const frameworkColors = { AT: 'framework-at', DE: 'framework-de', NL: 'framework-nl' };

            return (
                <button
                    onClick={onClick}
                    className={`${frameworkColors[framework]} module-card bg-white rounded-xl p-6 shadow-md hover:shadow-lg text-left w-full border-l-4 accent-border`}
                >
                    <div className="text-3xl mb-3">{icon}</div>
                    <h3 className="text-lg font-semibold text-gray-900 mb-2">{title}</h3>
                    <p className="text-sm text-gray-600">{description}</p>
                </button>
            );
        };

        // Law Browser Module
        const LawBrowserModule = ({ onBack }) => {
            const { framework, language, apiKey, t } = useApp();
            const [searchTerm, setSearchTerm] = useState('');
            const [expandedSections, setExpandedSections] = useState([]);
            const [selectedSection, setSelectedSection] = useState(null);
            const [bookmarks, setBookmarks] = useState(() => {
                const saved = localStorage.getItem('law_bookmarks');
                return saved ? JSON.parse(saved) : [];
            });
            const [aiExplanation, setAiExplanation] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const laws = lawData[framework];

            const toggleSection = (id) => {
                setExpandedSections(prev =>
                    prev.includes(id) ? prev.filter(s => s !== id) : [...prev, id]
                );
            };

            const toggleBookmark = (sectionId) => {
                const newBookmarks = bookmarks.includes(sectionId)
                    ? bookmarks.filter(b => b !== sectionId)
                    : [...bookmarks, sectionId];
                setBookmarks(newBookmarks);
                localStorage.setItem('law_bookmarks', JSON.stringify(newBookmarks));
            };

            const highlightText = (text, term) => {
                if (!term) return text;
                const regex = new RegExp(`(${term})`, 'gi');
                const parts = text.split(regex);
                return parts.map((part, i) =>
                    regex.test(part) ? <span key={i} className="highlight">{part}</span> : part
                );
            };

            const explainSimply = async (section) => {
                if (!apiKey) {
                    alert('Please configure your Gemini API key first');
                    return;
                }
                setIsLoading(true);
                setAiExplanation('');
                try {
                    const response = await generateAIResponse(
                        `Explain this legal provision in simple, plain language that a non-lawyer can understand. Focus on practical implications for employers and employees:\n\n${section.title}\n${section.content}`,
                        apiKey,
                        framework,
                        language
                    );
                    setAiExplanation(response);
                } catch (error) {
                    setAiExplanation('Error generating explanation. Please try again.');
                }
                setIsLoading(false);
            };

            const filteredSections = useMemo(() => {
                if (!searchTerm) return laws.sections;
                const term = searchTerm.toLowerCase();
                return laws.sections.map(part => ({
                    ...part,
                    sections: part.sections.filter(s =>
                        s.title.toLowerCase().includes(term) ||
                        s.content.toLowerCase().includes(term)
                    )
                })).filter(part => part.sections.length > 0);
            }, [laws.sections, searchTerm]);

            return (
                <div className="fade-in">
                    <button onClick={onBack} className="text-blue-600 hover:text-blue-800 mb-4 flex items-center gap-1">
                        ‚Üê {t.common.back}
                    </button>

                    <h2 className="text-2xl font-bold mb-2">{t.modules.lawBrowser}</h2>
                    <p className="text-gray-600 mb-4">{laws.name}</p>

                    <div className="mb-6">
                        <input
                            type="text"
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                            placeholder={t.common.searchPlaceholder}
                            className="w-full px-4 py-3 border rounded-lg"
                        />
                    </div>

                    <div className="grid md:grid-cols-2 gap-6">
                        {/* Law Tree */}
                        <div className="bg-white rounded-lg shadow-md p-4 max-h-[600px] overflow-y-auto">
                            {filteredSections.map(part => (
                                <div key={part.id} className="mb-2">
                                    <button
                                        onClick={() => toggleSection(part.id)}
                                        className="w-full text-left px-3 py-2 bg-gray-100 rounded-lg font-medium flex items-center justify-between hover:bg-gray-200"
                                    >
                                        <span>{highlightText(part.title, searchTerm)}</span>
                                        <span>{expandedSections.includes(part.id) ? '‚àí' : '+'}</span>
                                    </button>
                                    {expandedSections.includes(part.id) && (
                                        <div className="ml-4 mt-2 space-y-1">
                                            {part.sections.map(section => (
                                                <button
                                                    key={section.id}
                                                    onClick={() => setSelectedSection(section)}
                                                    className={`w-full text-left px-3 py-2 rounded tree-item flex items-center justify-between ${selectedSection?.id === section.id ? 'bg-blue-100' : ''}`}
                                                >
                                                    <span className="text-sm">{highlightText(section.title, searchTerm)}</span>
                                                    {bookmarks.includes(section.id) && <span className="text-yellow-500">‚òÖ</span>}
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            ))}
                            {filteredSections.length === 0 && (
                                <p className="text-gray-500 text-center py-8">{t.common.noResults}</p>
                            )}
                        </div>

                        {/* Section Detail */}
                        <div className="bg-white rounded-lg shadow-md p-4">
                            {selectedSection ? (
                                <div>
                                    <div className="flex items-start justify-between mb-4">
                                        <h3 className="text-lg font-semibold">{selectedSection.title}</h3>
                                        <button
                                            onClick={() => toggleBookmark(selectedSection.id)}
                                            className="text-2xl"
                                        >
                                            {bookmarks.includes(selectedSection.id) ? '‚òÖ' : '‚òÜ'}
                                        </button>
                                    </div>
                                    <p className="text-gray-700 mb-4 leading-relaxed">
                                        {highlightText(selectedSection.content, searchTerm)}
                                    </p>
                                    <button
                                        onClick={() => explainSimply(selectedSection)}
                                        disabled={isLoading}
                                        className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
                                    >
                                        {isLoading ? <span className="loading-dots">{t.common.loading}</span> : `‚ú® ${t.common.explain}`}
                                    </button>

                                    {aiExplanation && (
                                        <div className="mt-4 p-4 bg-blue-50 rounded-lg">
                                            <h4 className="font-medium text-blue-800 mb-2">AI Explanation</h4>
                                            <p className="text-gray-700 whitespace-pre-wrap">{aiExplanation}</p>
                                        </div>
                                    )}
                                </div>
                            ) : (
                                <div className="text-center py-12 text-gray-500">
                                    <p>Select a section to view details</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Compliance Checker Module
        const ComplianceCheckerModule = ({ onBack }) => {
            const { framework, language, apiKey, t } = useApp();
            const [companySize, setCompanySize] = useState('');
            const [industry, setIndustry] = useState('');
            const [topic, setTopic] = useState('');
            const [result, setResult] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const companySizes = ['1-10', '11-50', '51-100', '101-250', '250+'];

            const checkCompliance = async () => {
                if (!apiKey) {
                    alert('Please configure your Gemini API key first');
                    return;
                }
                if (!companySize || !industry || !topic) {
                    alert('Please fill in all fields');
                    return;
                }

                setIsLoading(true);
                setResult('');

                try {
                    const prompt = `Provide a detailed compliance checklist for a ${industry} company with ${companySize} employees regarding ${topic}.

Include:
1. Specific legal requirements with paragraph citations
2. Required documentation
3. Personnel requirements (if any)
4. Deadlines and frequencies for reviews/inspections
5. Potential penalties for non-compliance
6. Practical implementation steps

Format the response with clear sections and bullet points.`;

                    const response = await generateAIResponse(prompt, apiKey, framework, language);
                    setResult(response);
                } catch (error) {
                    setResult('Error generating compliance check. Please try again.');
                }
                setIsLoading(false);
            };

            return (
                <div className="fade-in">
                    <button onClick={onBack} className="text-blue-600 hover:text-blue-800 mb-4 flex items-center gap-1">
                        ‚Üê {t.common.back}
                    </button>

                    <h2 className="text-2xl font-bold mb-6">{t.modules.complianceChecker}</h2>

                    <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                        <div className="grid md:grid-cols-3 gap-4 mb-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    {t.common.companySize}
                                </label>
                                <select
                                    value={companySize}
                                    onChange={(e) => setCompanySize(e.target.value)}
                                    className="w-full px-3 py-2 border rounded-lg"
                                >
                                    <option value="">{t.common.selectOption}</option>
                                    {companySizes.map(size => (
                                        <option key={size} value={size}>{size} {t.common.employees}</option>
                                    ))}
                                </select>
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    {t.common.industry}
                                </label>
                                <select
                                    value={industry}
                                    onChange={(e) => setIndustry(e.target.value)}
                                    className="w-full px-3 py-2 border rounded-lg"
                                >
                                    <option value="">{t.common.selectOption}</option>
                                    {Object.entries(t.industries).map(([key, value]) => (
                                        <option key={key} value={value}>{value}</option>
                                    ))}
                                </select>
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    {t.common.topic}
                                </label>
                                <select
                                    value={topic}
                                    onChange={(e) => setTopic(e.target.value)}
                                    className="w-full px-3 py-2 border rounded-lg"
                                >
                                    <option value="">{t.common.selectOption}</option>
                                    {Object.entries(t.topics).map(([key, value]) => (
                                        <option key={key} value={value}>{value}</option>
                                    ))}
                                </select>
                            </div>
                        </div>

                        <button
                            onClick={checkCompliance}
                            disabled={isLoading || !companySize || !industry || !topic}
                            className="w-full py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50"
                        >
                            {isLoading ? <span className="loading-dots">{t.common.loading}</span> : `üîç Check Compliance`}
                        </button>
                    </div>

                    {result && (
                        <div className="bg-white rounded-lg shadow-md p-6">
                            <h3 className="text-lg font-semibold mb-4">Compliance Requirements</h3>
                            <div className="prose max-w-none">
                                <pre className="whitespace-pre-wrap text-sm text-gray-700 bg-gray-50 p-4 rounded-lg">{result}</pre>
                            </div>
                            <div className="mt-4 flex gap-2">
                                <button
                                    onClick={() => navigator.clipboard.writeText(result)}
                                    className="px-4 py-2 border rounded-lg hover:bg-gray-50"
                                >
                                    üìã {t.common.copy}
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Document Generator Module
        const DocumentGeneratorModule = ({ onBack }) => {
            const { framework, language, apiKey, t } = useApp();
            const [selectedTemplate, setSelectedTemplate] = useState('');
            const [inputs, setInputs] = useState({});
            const [generatedDoc, setGeneratedDoc] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const templates = {
                riskAssessment: {
                    name: t.documents.riskAssessment,
                    icon: 'üìã',
                    fields: ['workplace', 'activity', 'department']
                },
                asaMeeting: {
                    name: t.documents.asaMeeting,
                    icon: 'üìÖ',
                    fields: ['date', 'attendees', 'mainTopics']
                },
                committeeMinutes: {
                    name: t.documents.committeeMinutes,
                    icon: 'üìù',
                    fields: ['date', 'attendees', 'discussedItems']
                },
                inspectionChecklist: {
                    name: t.documents.inspectionChecklist,
                    icon: '‚úÖ',
                    fields: ['workplace', 'inspectionType', 'area']
                },
                incidentReport: {
                    name: t.documents.incidentReport,
                    icon: '‚ö†Ô∏è',
                    fields: ['date', 'location', 'description', 'injuredPerson']
                },
                trainingDoc: {
                    name: t.documents.trainingDoc,
                    icon: 'üéì',
                    fields: ['trainingType', 'date', 'participants', 'trainer']
                }
            };

            const fieldLabels = {
                en: {
                    workplace: 'Workplace/Area',
                    activity: 'Activity/Process',
                    department: 'Department',
                    date: 'Date',
                    attendees: 'Attendees',
                    mainTopics: 'Main Topics',
                    discussedItems: 'Items Discussed',
                    inspectionType: 'Inspection Type',
                    area: 'Area to Inspect',
                    location: 'Location',
                    description: 'Description of Incident',
                    injuredPerson: 'Injured Person (if any)',
                    trainingType: 'Training Type',
                    participants: 'Participants',
                    trainer: 'Trainer Name'
                },
                de: {
                    workplace: 'Arbeitsplatz/Bereich',
                    activity: 'T√§tigkeit/Prozess',
                    department: 'Abteilung',
                    date: 'Datum',
                    attendees: 'Teilnehmer',
                    mainTopics: 'Hauptthemen',
                    discussedItems: 'Besprochene Punkte',
                    inspectionType: 'Inspektionsart',
                    area: 'Zu inspizierender Bereich',
                    location: 'Ort',
                    description: 'Beschreibung des Vorfalls',
                    injuredPerson: 'Verletzte Person (falls vorhanden)',
                    trainingType: 'Schulungsart',
                    participants: 'Teilnehmer',
                    trainer: 'Name des Trainers'
                },
                nl: {
                    workplace: 'Werkplek/Gebied',
                    activity: 'Activiteit/Proces',
                    department: 'Afdeling',
                    date: 'Datum',
                    attendees: 'Aanwezigen',
                    mainTopics: 'Hoofdonderwerpen',
                    discussedItems: 'Besproken Punten',
                    inspectionType: 'Inspectie Type',
                    area: 'Te Inspecteren Gebied',
                    location: 'Locatie',
                    description: 'Beschrijving van Incident',
                    injuredPerson: 'Gewonde Persoon (indien van toepassing)',
                    trainingType: 'Training Type',
                    participants: 'Deelnemers',
                    trainer: 'Naam Trainer'
                }
            };

            const generateDocument = async () => {
                if (!apiKey) {
                    alert('Please configure your Gemini API key first');
                    return;
                }
                if (!selectedTemplate) return;

                setIsLoading(true);
                setGeneratedDoc('');

                const template = templates[selectedTemplate];
                const inputDetails = template.fields.map(f => `${fieldLabels[language][f]}: ${inputs[f] || 'Not specified'}`).join('\n');

                const prompt = `Generate a professional ${template.name} document with the following details:

${inputDetails}

The document should:
1. Follow the legal requirements of the current framework
2. Include relevant legal citations
3. Be structured professionally with clear sections
4. Include all necessary fields for compliance
5. Be ready to use (only requiring signature if applicable)

Generate the complete document content in a professional format.`;

                try {
                    const response = await generateAIResponse(prompt, apiKey, framework, language);
                    setGeneratedDoc(response);
                } catch (error) {
                    setGeneratedDoc('Error generating document. Please try again.');
                }
                setIsLoading(false);
            };

            const downloadDocument = () => {
                const blob = new Blob([generatedDoc], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${selectedTemplate}_${new Date().toISOString().split('T')[0]}.txt`;
                a.click();
                URL.revokeObjectURL(url);
            };

            return (
                <div className="fade-in">
                    <button onClick={onBack} className="text-blue-600 hover:text-blue-800 mb-4 flex items-center gap-1">
                        ‚Üê {t.common.back}
                    </button>

                    <h2 className="text-2xl font-bold mb-6">{t.modules.documentGenerator}</h2>

                    {/* Template Selection */}
                    <div className="grid md:grid-cols-3 gap-4 mb-6">
                        {Object.entries(templates).map(([key, template]) => (
                            <button
                                key={key}
                                onClick={() => {
                                    setSelectedTemplate(key);
                                    setInputs({});
                                    setGeneratedDoc('');
                                }}
                                className={`p-4 bg-white rounded-lg shadow-md text-left hover:shadow-lg transition ${selectedTemplate === key ? 'ring-2 ring-blue-500' : ''}`}
                            >
                                <span className="text-2xl">{template.icon}</span>
                                <p className="mt-2 font-medium">{template.name}</p>
                            </button>
                        ))}
                    </div>

                    {/* Input Fields */}
                    {selectedTemplate && (
                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                            <h3 className="text-lg font-semibold mb-4">{templates[selectedTemplate].name}</h3>
                            <div className="grid md:grid-cols-2 gap-4 mb-6">
                                {templates[selectedTemplate].fields.map(field => (
                                    <div key={field}>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            {fieldLabels[language][field]}
                                        </label>
                                        <input
                                            type="text"
                                            value={inputs[field] || ''}
                                            onChange={(e) => setInputs({ ...inputs, [field]: e.target.value })}
                                            className="w-full px-3 py-2 border rounded-lg"
                                        />
                                    </div>
                                ))}
                            </div>
                            <button
                                onClick={generateDocument}
                                disabled={isLoading}
                                className="w-full py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 disabled:opacity-50"
                            >
                                {isLoading ? <span className="loading-dots">{t.common.loading}</span> : `üìÑ ${t.common.generate}`}
                            </button>
                        </div>
                    )}

                    {/* Generated Document */}
                    {generatedDoc && (
                        <div className="bg-white rounded-lg shadow-md p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-lg font-semibold">Generated Document</h3>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => navigator.clipboard.writeText(generatedDoc)}
                                        className="px-4 py-2 border rounded-lg hover:bg-gray-50"
                                    >
                                        üìã {t.common.copy}
                                    </button>
                                    <button
                                        onClick={downloadDocument}
                                        className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                                    >
                                        ‚¨áÔ∏è {t.common.download}
                                    </button>
                                </div>
                            </div>
                            <pre className="whitespace-pre-wrap text-sm text-gray-700 bg-gray-50 p-4 rounded-lg max-h-96 overflow-y-auto">{generatedDoc}</pre>
                        </div>
                    )}
                </div>
            );
        };

        // Quick Reference Module
        const QuickReferenceModule = ({ onBack }) => {
            const { framework, t } = useApp();
            const [activeTool, setActiveTool] = useState('deadline');
            const [employees, setEmployees] = useState('');
            const [lastInspection, setLastInspection] = useState('');
            const [calcResult, setCalcResult] = useState(null);

            const personnelRequirements = {
                AT: {
                    name: 'Austria (ASchG)',
                    svp: [
                        { min: 11, max: 50, count: 1 },
                        { min: 51, max: 100, count: 2 },
                        { min: 101, max: 300, count: 3 },
                        { min: 301, max: 500, count: 4 },
                        { min: 501, max: 1000, count: 5 },
                        { min: 1001, max: Infinity, count: '5 + 1 per 500' }
                    ],
                    sfk: 'Required in all workplaces - min. 25 hours/year per 100 employees',
                    amed: 'Required in all workplaces - min. 25 hours/year per 100 employees'
                },
                DE: {
                    name: 'Germany (DGUV/ArbSchG)',
                    sibe: [
                        { min: 21, max: Infinity, count: '1 per 250 employees' }
                    ],
                    fasi: 'Required - hours depend on risk category (0.2-2.5 hours/employee/year)',
                    betriebsarzt: 'Required - hours depend on risk category (0.2-1.5 hours/employee/year)'
                },
                NL: {
                    name: 'Netherlands (Arbowet)',
                    preventiemedewerker: [
                        { min: 1, max: 25, count: 'Employer can be PM' },
                        { min: 26, max: Infinity, count: '1 or more designated' }
                    ],
                    arbodeskundige: 'External or internal - depends on RI&E',
                    bhv: 'At least 1 BHV per 50 employees'
                }
            };

            const penalties = {
                AT: [
                    { violation: 'Missing risk assessment', penalty: 'Up to ‚Ç¨8,000', ref: '¬ß 4 ASchG' },
                    { violation: 'No safety personnel', penalty: 'Up to ‚Ç¨8,000', ref: '¬ß 73-76 ASchG' },
                    { violation: 'Missing first aid equipment', penalty: 'Up to ‚Ç¨5,000', ref: '¬ß 25 ASchG' },
                    { violation: 'Inadequate fire safety', penalty: 'Up to ‚Ç¨8,000', ref: '¬ß 25 ASchG' },
                    { violation: 'Missing safety training', penalty: 'Up to ‚Ç¨3,600', ref: '¬ß 14 ASchG' }
                ],
                DE: [
                    { violation: 'Missing Gef√§hrdungsbeurteilung', penalty: 'Up to ‚Ç¨30,000', ref: '¬ß 5 ArbSchG' },
                    { violation: 'No Fachkraft f√ºr Arbeitssicherheit', penalty: 'Up to ‚Ç¨25,000', ref: '¬ß 1 ASiG' },
                    { violation: 'Missing documentation', penalty: 'Up to ‚Ç¨5,000', ref: '¬ß 6 ArbSchG' },
                    { violation: 'No ASA meetings', penalty: 'Up to ‚Ç¨10,000', ref: '¬ß 11 ASiG' },
                    { violation: 'Missing annual instruction', penalty: 'Up to ‚Ç¨5,000', ref: 'DGUV V1 ¬ß4' }
                ],
                NL: [
                    { violation: 'Missing RI&E', penalty: 'Up to ‚Ç¨45,000', ref: 'Art. 5 Arbowet' },
                    { violation: 'No preventiemedewerker', penalty: 'Up to ‚Ç¨13,500', ref: 'Art. 13 Arbowet' },
                    { violation: 'Missing BHV', penalty: 'Up to ‚Ç¨13,500', ref: 'Art. 15 Arbowet' },
                    { violation: 'No voorlichting/onderricht', penalty: 'Up to ‚Ç¨4,500', ref: 'Art. 8 Arbowet' },
                    { violation: 'Missing arbodienst contract', penalty: 'Up to ‚Ç¨13,500', ref: 'Art. 14 Arbowet' }
                ]
            };

            const glossary = {
                AT: [
                    { abbr: 'ASchG', full: 'ArbeitnehmerInnenschutzgesetz', desc: 'Main occupational health and safety law' },
                    { abbr: 'SFK', full: 'Sicherheitsfachkraft', desc: 'Safety specialist' },
                    { abbr: 'SVP', full: 'Sicherheitsvertrauensperson', desc: 'Safety representative' },
                    { abbr: 'AMed', full: 'Arbeitsmediziner', desc: 'Occupational physician' },
                    { abbr: 'PSA', full: 'Pers√∂nliche Schutzausr√ºstung', desc: 'Personal protective equipment' },
                    { abbr: 'ASA', full: 'Arbeitsschutzausschuss', desc: 'Safety committee' }
                ],
                DE: [
                    { abbr: 'ArbSchG', full: 'Arbeitsschutzgesetz', desc: 'Occupational Health and Safety Act' },
                    { abbr: 'DGUV', full: 'Deutsche Gesetzliche Unfallversicherung', desc: 'German Social Accident Insurance' },
                    { abbr: 'ASiG', full: 'Arbeitssicherheitsgesetz', desc: 'Occupational Safety Act' },
                    { abbr: 'FaSi', full: 'Fachkraft f√ºr Arbeitssicherheit', desc: 'Safety specialist' },
                    { abbr: 'SiBe', full: 'Sicherheitsbeauftragter', desc: 'Safety officer' },
                    { abbr: 'ASA', full: 'Arbeitsschutzausschuss', desc: 'Occupational safety committee' },
                    { abbr: 'GBU', full: 'Gef√§hrdungsbeurteilung', desc: 'Risk assessment' }
                ],
                NL: [
                    { abbr: 'Arbowet', full: 'Arbeidsomstandighedenwet', desc: 'Working Conditions Act' },
                    { abbr: 'RI&E', full: 'Risico-Inventarisatie en -Evaluatie', desc: 'Risk inventory and evaluation' },
                    { abbr: 'PBM', full: 'Persoonlijke Beschermingsmiddelen', desc: 'Personal protective equipment' },
                    { abbr: 'BHV', full: 'Bedrijfshulpverlening', desc: 'Company emergency response' },
                    { abbr: 'PM', full: 'Preventiemedewerker', desc: 'Prevention officer' },
                    { abbr: 'SZW', full: 'Sociale Zaken en Werkgelegenheid', desc: 'Ministry of Social Affairs' }
                ]
            };

            const calculateDeadline = () => {
                if (!lastInspection) return;
                const lastDate = new Date(lastInspection);
                const nextDate = new Date(lastDate);
                nextDate.setFullYear(nextDate.getFullYear() + 1);

                const daysUntil = Math.ceil((nextDate - new Date()) / (1000 * 60 * 60 * 24));

                setCalcResult({
                    nextInspection: nextDate.toLocaleDateString(),
                    daysRemaining: daysUntil,
                    status: daysUntil < 0 ? 'overdue' : daysUntil < 30 ? 'urgent' : 'ok'
                });
            };

            const calculatePersonnel = () => {
                const emp = parseInt(employees);
                if (isNaN(emp) || emp < 1) return;

                const reqs = personnelRequirements[framework];
                let results = {};

                if (framework === 'AT') {
                    const svpReq = reqs.svp.find(r => emp >= r.min && emp <= r.max);
                    results = {
                        svp: svpReq ? svpReq.count : 0,
                        sfk: reqs.sfk,
                        amed: reqs.amed
                    };
                } else if (framework === 'DE') {
                    results = {
                        sibe: emp >= 21 ? Math.ceil(emp / 250) : 0,
                        fasi: reqs.fasi,
                        betriebsarzt: reqs.betriebsarzt,
                        asa: emp > 20 ? 'Required' : 'Not required'
                    };
                } else {
                    results = {
                        preventiemedewerker: emp <= 25 ? 'Employer can fulfill role' : Math.ceil(emp / 250),
                        bhv: Math.ceil(emp / 50),
                        arbodeskundige: reqs.arbodeskundige
                    };
                }

                setCalcResult(results);
            };

            return (
                <div className="fade-in">
                    <button onClick={onBack} className="text-blue-600 hover:text-blue-800 mb-4 flex items-center gap-1">
                        ‚Üê {t.common.back}
                    </button>

                    <h2 className="text-2xl font-bold mb-6">{t.modules.quickReference}</h2>

                    {/* Tool Tabs */}
                    <div className="flex flex-wrap gap-2 mb-6">
                        {[
                            { id: 'deadline', label: t.tools.deadlineCalculator, icon: 'üìÖ' },
                            { id: 'personnel', label: t.tools.personnelCalculator, icon: 'üë•' },
                            { id: 'penalty', label: t.tools.penaltyLookup, icon: '‚öñÔ∏è' },
                            { id: 'glossary', label: t.tools.glossary, icon: 'üìñ' }
                        ].map(tool => (
                            <button
                                key={tool.id}
                                onClick={() => { setActiveTool(tool.id); setCalcResult(null); }}
                                className={`px-4 py-2 rounded-lg font-medium ${activeTool === tool.id ? 'bg-blue-600 text-white' : 'bg-white border hover:bg-gray-50'}`}
                            >
                                {tool.icon} {tool.label}
                            </button>
                        ))}
                    </div>

                    <div className="bg-white rounded-lg shadow-md p-6">
                        {/* Deadline Calculator */}
                        {activeTool === 'deadline' && (
                            <div>
                                <h3 className="text-lg font-semibold mb-4">{t.tools.deadlineCalculator}</h3>
                                <div className="grid md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Last Inspection Date
                                        </label>
                                        <input
                                            type="date"
                                            value={lastInspection}
                                            onChange={(e) => setLastInspection(e.target.value)}
                                            className="w-full px-3 py-2 border rounded-lg"
                                        />
                                    </div>
                                </div>
                                <button
                                    onClick={calculateDeadline}
                                    className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                                >
                                    {t.common.calculate}
                                </button>

                                {calcResult && (
                                    <div className={`mt-4 p-4 rounded-lg ${calcResult.status === 'overdue' ? 'bg-red-100' : calcResult.status === 'urgent' ? 'bg-yellow-100' : 'bg-green-100'}`}>
                                        <p className="font-medium">Next Inspection Due: {calcResult.nextInspection}</p>
                                        <p className={`text-lg font-bold ${calcResult.status === 'overdue' ? 'text-red-600' : calcResult.status === 'urgent' ? 'text-yellow-600' : 'text-green-600'}`}>
                                            {calcResult.daysRemaining < 0
                                                ? `${Math.abs(calcResult.daysRemaining)} days overdue!`
                                                : `${calcResult.daysRemaining} days remaining`}
                                        </p>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Personnel Calculator */}
                        {activeTool === 'personnel' && (
                            <div>
                                <h3 className="text-lg font-semibold mb-4">{t.tools.personnelCalculator}</h3>
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Number of Employees
                                    </label>
                                    <input
                                        type="number"
                                        value={employees}
                                        onChange={(e) => setEmployees(e.target.value)}
                                        placeholder="Enter number of employees"
                                        className="w-full px-3 py-2 border rounded-lg"
                                        min="1"
                                    />
                                </div>
                                <button
                                    onClick={calculatePersonnel}
                                    className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                                >
                                    {t.common.calculate}
                                </button>

                                {calcResult && (
                                    <div className="mt-4 space-y-3">
                                        {Object.entries(calcResult).map(([key, value]) => (
                                            <div key={key} className="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                                <span className="font-medium capitalize">{key.replace(/([A-Z])/g, ' $1')}</span>
                                                <span className="text-blue-600 font-bold">{value}</span>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Penalty Lookup */}
                        {activeTool === 'penalty' && (
                            <div>
                                <h3 className="text-lg font-semibold mb-4">{t.tools.penaltyLookup}</h3>
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead>
                                            <tr className="bg-gray-100">
                                                <th className="text-left p-3">Violation</th>
                                                <th className="text-left p-3">Max Penalty</th>
                                                <th className="text-left p-3">Reference</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {penalties[framework].map((item, i) => (
                                                <tr key={i} className="border-b">
                                                    <td className="p-3">{item.violation}</td>
                                                    <td className="p-3 text-red-600 font-medium">{item.penalty}</td>
                                                    <td className="p-3 text-gray-600">{item.ref}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* Glossary */}
                        {activeTool === 'glossary' && (
                            <div>
                                <h3 className="text-lg font-semibold mb-4">{t.tools.glossary}</h3>
                                <div className="space-y-2">
                                    {glossary[framework].map((item, i) => (
                                        <div key={i} className="p-3 bg-gray-50 rounded-lg">
                                            <div className="flex items-center gap-3">
                                                <span className="font-bold text-blue-600 min-w-[80px]">{item.abbr}</span>
                                                <span className="font-medium">{item.full}</span>
                                            </div>
                                            <p className="text-sm text-gray-600 mt-1 ml-[92px]">{item.desc}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Regulation Lookup Module
        const RegulationLookupModule = ({ onBack }) => {
            const { framework, language, apiKey, t } = useApp();
            const [topic, setTopic] = useState('');
            const [companySize, setCompanySize] = useState('');
            const [result, setResult] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const companySizes = ['1-10', '11-50', '51-100', '101-250', '250+'];

            const lookupRegulations = async () => {
                if (!apiKey) {
                    alert('Please configure your Gemini API key first');
                    return;
                }
                if (!topic) {
                    alert('Please enter a topic');
                    return;
                }

                setIsLoading(true);
                setResult('');

                const prompt = `What are the specific legal requirements for "${topic}" in a company with ${companySize || 'any number of'} employees?

Provide:
1. **Specific Legal Requirements** - Cite exact paragraphs
2. **Practical Implementation Steps** - What exactly needs to be done
3. **Documentation Requirements** - What records must be kept
4. **Frequency/Deadlines** - How often things must be reviewed/done
5. **Penalties for Non-Compliance** - What happens if not followed
6. **Checklist** - A simple yes/no checklist to verify compliance

Be specific and practical. Include all relevant legal citations.`;

                try {
                    const response = await generateAIResponse(prompt, apiKey, framework, language);
                    setResult(response);
                } catch (error) {
                    setResult('Error looking up regulations. Please try again.');
                }
                setIsLoading(false);
            };

            return (
                <div className="fade-in">
                    <button onClick={onBack} className="text-blue-600 hover:text-blue-800 mb-4 flex items-center gap-1">
                        ‚Üê {t.common.back}
                    </button>

                    <h2 className="text-2xl font-bold mb-6">{t.modules.regulationLookup}</h2>

                    <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                        <p className="text-gray-600 mb-4">Query: "What are the requirements for [TOPIC] in a company with [SIZE] employees?"</p>

                        <div className="grid md:grid-cols-2 gap-4 mb-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    {t.common.topic} *
                                </label>
                                <input
                                    type="text"
                                    value={topic}
                                    onChange={(e) => setTopic(e.target.value)}
                                    placeholder="e.g., First Aid, Fire Extinguishers, PPE, Risk Assessment..."
                                    className="w-full px-3 py-2 border rounded-lg"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    {t.common.companySize} (optional)
                                </label>
                                <select
                                    value={companySize}
                                    onChange={(e) => setCompanySize(e.target.value)}
                                    className="w-full px-3 py-2 border rounded-lg"
                                >
                                    <option value="">Any size</option>
                                    {companySizes.map(size => (
                                        <option key={size} value={size}>{size} {t.common.employees}</option>
                                    ))}
                                </select>
                            </div>
                        </div>

                        <button
                            onClick={lookupRegulations}
                            disabled={isLoading || !topic}
                            className="w-full py-3 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 disabled:opacity-50"
                        >
                            {isLoading ? <span className="loading-dots">{t.common.loading}</span> : `üîç ${t.common.lookup}`}
                        </button>
                    </div>

                    {/* Quick Topic Buttons */}
                    <div className="mb-6">
                        <p className="text-sm text-gray-600 mb-2">Quick topics:</p>
                        <div className="flex flex-wrap gap-2">
                            {Object.values(t.topics).map((topicName, i) => (
                                <button
                                    key={i}
                                    onClick={() => setTopic(topicName)}
                                    className="px-3 py-1 text-sm bg-gray-100 rounded-full hover:bg-gray-200"
                                >
                                    {topicName}
                                </button>
                            ))}
                        </div>
                    </div>

                    {result && (
                        <div className="bg-white rounded-lg shadow-md p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-lg font-semibold">Requirements for: {topic}</h3>
                                <button
                                    onClick={() => navigator.clipboard.writeText(result)}
                                    className="px-4 py-2 border rounded-lg hover:bg-gray-50"
                                >
                                    üìã {t.common.copy}
                                </button>
                            </div>
                            <pre className="whitespace-pre-wrap text-sm text-gray-700 bg-gray-50 p-4 rounded-lg max-h-[500px] overflow-y-auto">{result}</pre>
                        </div>
                    )}
                </div>
            );
        };

        // Main Dashboard
        const Dashboard = ({ onModuleSelect }) => {
            const { t } = useApp();

            const modules = [
                { id: 'lawBrowser', icon: 'üìö', title: t.modules.lawBrowser, description: t.modules.lawBrowserDesc },
                { id: 'complianceChecker', icon: '‚úÖ', title: t.modules.complianceChecker, description: t.modules.complianceCheckerDesc },
                { id: 'documentGenerator', icon: 'üìÑ', title: t.modules.documentGenerator, description: t.modules.documentGeneratorDesc },
                { id: 'quickReference', icon: '‚ö°', title: t.modules.quickReference, description: t.modules.quickReferenceDesc },
                { id: 'regulationLookup', icon: 'üîç', title: t.modules.regulationLookup, description: t.modules.regulationLookupDesc }
            ];

            return (
                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {modules.map(module => (
                        <ModuleCard
                            key={module.id}
                            icon={module.icon}
                            title={module.title}
                            description={module.description}
                            onClick={() => onModuleSelect(module.id)}
                        />
                    ))}
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [framework, setFramework] = useState(() => localStorage.getItem('whs_framework') || 'DE');
            const [language, setLanguage] = useState(() => localStorage.getItem('whs_language') || 'en');
            const [apiKey, setApiKey] = useState(() => localStorage.getItem('gemini_api_key') || '');
            const [activeModule, setActiveModule] = useState(null);

            useEffect(() => {
                localStorage.setItem('whs_framework', framework);
            }, [framework]);

            useEffect(() => {
                localStorage.setItem('whs_language', language);
            }, [language]);

            const t = translations[language];

            const frameworkColors = { AT: 'framework-at', DE: 'framework-de', NL: 'framework-nl' };

            const contextValue = {
                framework,
                setFramework,
                language,
                setLanguage,
                apiKey,
                setApiKey,
                t
            };

            const renderModule = () => {
                switch (activeModule) {
                    case 'lawBrowser':
                        return <LawBrowserModule onBack={() => setActiveModule(null)} />;
                    case 'complianceChecker':
                        return <ComplianceCheckerModule onBack={() => setActiveModule(null)} />;
                    case 'documentGenerator':
                        return <DocumentGeneratorModule onBack={() => setActiveModule(null)} />;
                    case 'quickReference':
                        return <QuickReferenceModule onBack={() => setActiveModule(null)} />;
                    case 'regulationLookup':
                        return <RegulationLookupModule onBack={() => setActiveModule(null)} />;
                    default:
                        return <Dashboard onModuleSelect={setActiveModule} />;
                }
            };

            return (
                <AppContext.Provider value={contextValue}>
                    <div className={frameworkColors[framework]}>
                        <Header />
                        <main className="max-w-7xl mx-auto px-4 py-8">
                            <ApiKeySetup />
                            {renderModule()}
                        </main>
                        <footer className="bg-white border-t mt-12 py-6">
                            <div className="max-w-7xl mx-auto px-4 text-center text-sm text-gray-500">
                                <p>WHS Safety Compliance Navigator ‚Ä¢ For informational purposes only</p>
                                <p className="mt-1">Always consult official sources and legal professionals for binding advice</p>
                            </div>
                        </footer>
                    </div>
                </AppContext.Provider>
            );
        };

        // Render
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
